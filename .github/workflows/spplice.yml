name: Spplice Package
on: [push]

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      # checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          path: repo
      - name: Parse package name
        id: parse
        run: echo "name=$(jq -r '.name' repo/manifest.json)" >> "$GITHUB_OUTPUT"
      # create archives
      - name: Create inner archive
        run: tar -cJf ${{ steps.parse.outputs.name }}.tar.xz --exclude='.[^/]*' --exclude=manifest.json -C repo .
      - name: Create outer archive
        run: tar -cf ${{ steps.parse.outputs.name }}.sppkg ${{ steps.parse.outputs.name }}.tar.xz -C repo manifest.json
      # publish artifacts
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Spplice Package (unzip first)
          path: ${{ steps.parse.outputs.name }}.sppkg