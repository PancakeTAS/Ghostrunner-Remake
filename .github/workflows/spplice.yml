name: Spplice Package
on: [push]

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true
          path: p2ghostrunner
      # extract vpp.dll
      - name: Rename vpp to vppraw
        run: mv p2ghostrunner/vpp vpp
      - name: Create vpp new folder
        run: mkdir p2ghostrunner/vpp
      - name: Copy vpp.dll
        run: cp vpp/vpp.dll p2ghostrunner/vpp/
      # create archives
      - name: Create inner archive
        run: tar -cJf p2ghostrunner.tar.xz --exclude=.git --exclude=.github --exclude=manifest.json --exclude=.gitmodules --exclude=.gitignore --exclude=_master.cache --exclude=prepare -C p2ghostrunner .
      - name: Leave directory
        run: cd ..
      - name: Prepare outer archive folder
        run: mkdir package
      - name: Move file into package
        run: mv p2ghostrunner/manifest.json p2ghostrunner.tar.xz package
      - name: Create outer archive
        run: tar -cf p2ghostrunner.sppkg -C package . 
      # publish artifacts
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Spplice Package (unzip first)
          path: p2ghostrunner.sppkg

                
